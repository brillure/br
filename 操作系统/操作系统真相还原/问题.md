

### **将数据和代码分开的好处？**

**第一，可以为它们赋予不同的属性。**

​		例如数据本身是需要修改的，所以数据就需要有可写的属性，不让数据段可写，那程序根本就无法执行啦。程序中的代码是不能被更改的，这样就要求代码段具备只读的属性。真要是在运行过程中程序的下 一条指令被修改了，谁知道会产生什么样的灾难。

**第二，为了提高 CPU 内部缓存的命中率。**
大伙儿知道，缓存起作用的原因是程序的局部性原理。在 CPU 内部也有缓存机制，将程序中的指令 和数据分离，这有利于增强程序的局部性。CPU 内部有针对数据和针对指令的两种缓存机制，因此，将 数据和代码分开存储将使程序运行得更快。

**第三，节省内存**。
程序中存在一些只读的部分，比如代码，当一个程序的多个副本同时运行时(比如同时执行多个 ls 命令时)，没必要在内存中同时存在多个相同的代码段，这将浪费有限的物理内存资源，只要把这一个代 码段共享就可以了。



### 数据段和代码段的属性谁来添加的？

​		1)编译器负责挑选出数据具备的属性，从而根据属性将程序片段分类，比如，划分出了只读属性的代码段和可写属性的数据段。再补充一下，<u>编译器并没有让段具备某种属性，对于代码段，编译器所做的只是将代码归类到一起而已</u>，也就是将程序中的有关代码的多个 section 合并成一个大的 segment(这就是 我们所说的代码段)，它并没有为代码段添加额外的信息。

​		2)操作系统通过设置 GDT 全局描述符表来构建段描述符，在段描述符中指定段的位置、大小及属性(包括 S 字段和 TYPE 字段)。也就是说，<u>操作系统认为代码应该是只读的，所以给用来指向代码段的那个段描述符设置了只读的属性，这才是真正给段添加属性的地方。</u>

​		3)CPU 中的段寄存器提前被操作系统赋予相应的选择子(后面章节会讲什么是选择子，暂时将其 理解为相当于段基址)，从而确定了指向的段。在执行指令时，会根据该段的属性来判断指令的行为，若 有返回则发出异常。

